<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Desk Dashboard</title>
    <style>
        /* Using dvh (Dynamic Viewport Height) to handle Chrome's auto-hiding address bar */
        body, html { 
            margin: 0; 
            padding: 0; 
            height: 100dvh; 
            overflow: hidden; 
            background: #121212; 
            color: white; 
            font-family: sans-serif; 
        }

        #container { 
            display: flex; 
            flex-direction: column; 
            height: 100dvh; 
        }

        /* Clock & Date Section */
        #clock-area { 
            height: 35%; 
            display: flex; 
            flex-direction: column;
            align-items: center; 
            justify-content: center; 
            background: #1a1a1a; 
            border-bottom: 2px solid #333; 
        }

        #clock { font-size: 18vw; font-weight: bold; font-family: monospace; color: #00ff00; line-height: 1; }
        #date { font-size: 2vw; font-weight: normal; font-family: monospace; color: #888; margin-top: 10px; text-transform: uppercase; }

        /* Drawing Section */
        #drawing-area { 
            flex-grow: 1; 
            position: relative; 
            background: #121212; 
        }

        canvas { 
            display: block;
            width: 100%; 
            height: 100%; 
            touch-action: none; 
            z-index: 1; 
        }

        /* Fixed positioning ensures it stays on top of the canvas stacking context */
        #controls { 
            position: fixed; 
            bottom: 25px; 
            right: 25px; 
            z-index: 9999; 
        }

        button { 
            padding: 16px 28px; 
            background: #cc0000; 
            color: white; 
            border: 2px solid #ffffff; 
            border-radius: 10px; 
            cursor: pointer; 
            font-weight: bold; 
            font-size: 16px;
            /* Modern mobile properties */
            -webkit-appearance: none; 
            touch-action: manipulation;
            user-select: none;
        }

        button:active {
            background: #ff0000;
        }
    </style>
</head>
<body>

<div id="container">
    <div id="clock-area">
        <div id="clock">00:00:00</div>
        <div id="date">01-Jan-1970</div>
    </div>

    <div id="drawing-area">
        <canvas id="canvas"></canvas>
    </div>
</div>

<div id="controls">
    <button id="clear-btn">Clear Notes</button>
</div>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const clockEl = document.getElementById('clock');
    const dateEl = document.getElementById('date');
    let drawing = false;

    // --- Clock & Date Logic ---
    function updateDisplay() {
        const now = new Date();
        clockEl.textContent = now.toLocaleTimeString('en-AU', { hour12: false });

        const day = String(now.getDate()).padStart(2, '0');
        const month = now.toLocaleString('en-AU', { month: 'short' });
        const year = now.getFullYear();
        dateEl.textContent = `${day}-${month}-${year}`;
    }
    setInterval(updateDisplay, 1000);
    updateDisplay();

    // --- Persistence & Drawing Logic ---
    function setupCanvasStyles() {
        ctx.strokeStyle = "#ffffff";
        ctx.lineWidth = 4;
        ctx.lineCap = "round";
        ctx.lineJoin = "round";
    }

    function saveCanvas() {
        localStorage.setItem('savedDrawing', canvas.toDataURL());
    }

    function loadCanvas() {
        const dataURL = localStorage.getItem('savedDrawing');
        if (dataURL) {
            const img = new Image();
            img.onload = () => ctx.drawImage(img, 0, 0);
            img.src = dataURL;
        }
    }

    function resize() {
        // Capture current content before resizing
        const tempImage = canvas.toDataURL();
        canvas.width = canvas.offsetWidth;
        canvas.height = canvas.offsetHeight;
        setupCanvasStyles();
        
        const img = new Image();
        img.onload = () => ctx.drawImage(img, 0, 0);
        img.src = tempImage;
    }

    window.addEventListener('resize', resize);
    
    // Initial Setup
    canvas.width = canvas.offsetWidth;
    canvas.height = canvas.offsetHeight;
    setupCanvasStyles();
    loadCanvas();

    // Unified Pointer Events (Handles Mouse & Touch perfectly in Chrome)
    function start(e) { 
        drawing = true; 
        draw(e); 
    }

    function stop() { 
        if (drawing) {
            drawing = false; 
            ctx.beginPath(); 
            saveCanvas(); 
        }
    }

    function draw(e) {
        if (!drawing) return;
        
        const rect = canvas.getBoundingClientRect();
        const x = (e.clientX || (e.touches && e.touches[0].clientX)) - rect.left;
        const y = (e.clientY || (e.touches && e.touches[0].clientY)) - rect.top;

        ctx.lineTo(x, y);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(x, y);
    }

    canvas.addEventListener('pointerdown', start);
    window.addEventListener('pointermove', draw);
    window.addEventListener('pointerup', stop);

    function clearCanvas() {
        if (confirm("Clear all notes?")) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            localStorage.removeItem('savedDrawing');
        }
    }

    // Button Logic using pointerdown to bypass 300ms click delays
    const clearBtn = document.getElementById('clear-btn');
    clearBtn.addEventListener('pointerdown', (e) => {
        e.stopPropagation(); // Stop drawing from starting under the button
        clearCanvas();
    });
</script>

</body>
</html>
